# Настройка Zigbee2MQTT для RoboSR2CH10A

## Обзор

RoboSR2CH10A требует специальный конвертер для корректной работы с Zigbee2MQTT. Этот файл содержит инструкции по настройке конвертера.

## Файл конвертера

### Название файла
- `RoboSR2CH10A.js` - конвертер для Zigbee2MQTT

### Назначение
- Преобразование Zigbee команд в MQTT сообщения
- Генерация поля "action" при изменении состояния реле
- Синхронизация состояний между устройством и Zigbee2MQTT

## Установка конвертера

### 1. Скачивание файла
1. Скачайте файл `RoboSR2CH10A.js` из релиза
2. Сохраните файл в папку конвертеров Zigbee2MQTT

### 2. Расположение файла

#### Docker (рекомендуется)
```bash
# Путь к папке конвертеров
/opt/zigbee2mqtt/data/devices/
```

#### Установка из npm
```bash
# Путь к папке конвертеров
~/.zigbee2mqtt/node_modules/zigbee-herdsman-converters/devices/
```

#### Ручная установка
```bash
# Путь к папке конвертеров
/path/to/zigbee2mqtt/node_modules/zigbee-herdsman-converters/devices/
```

### 3. Копирование файла
```bash
# Скопируйте файл в папку конвертеров
cp RoboSR2CH10A.js /path/to/zigbee2mqtt/data/devices/
```

## Настройка Zigbee2MQTT

### 1. Редактирование конфигурации
Откройте файл `configuration.yaml`:

```yaml
# Добавьте в секцию devices
devices:
  - 'RoboSR2CH10A.js'
```

### 2. Альтернативный способ (рекомендуется)
Добавьте в `configuration.yaml`:

```yaml
# В секцию experimental
experimental:
  new_api: true

# В секцию advanced
advanced:
  # Включите кастомные конвертеры
  legacy_api: false
```

### 3. Перезапуск Zigbee2MQTT
```bash
# Docker
docker restart zigbee2mqtt

# Systemd
sudo systemctl restart zigbee2mqtt

# Ручной запуск
pm2 restart zigbee2mqtt
```

## Проверка работы

### 1. Подключение устройства
1. Включите RoboSR2CH10A
2. Устройство должно появиться в Zigbee2MQTT
3. Проверьте, что отображается как "RoboSR2CH10A"

### 2. Проверка функций
1. **Управление реле:**
   - Включите/выключите реле через Zigbee2MQTT UI
   - Проверьте, что реле физически переключается

2. **Локальное управление:**
   - Нажмите кнопку на устройстве
   - Проверьте, что состояние обновляется в Zigbee2MQTT

3. **Поле "action":**
   - При изменении состояния должно генерироваться поле "action"
   - Формат: `on_l1`, `off_l1`, `on_l2`, `off_l2`

## Структура MQTT сообщений

### Состояние устройства
```json
{
  "linkquality": 156,
  "state_1": "OFF",
  "state_2": "OFF",
  "action": "off_l1"
}
```

### Команды управления
```json
// Включить реле 1
{
  "state_1": "ON"
}

// Выключить реле 2
{
  "state_2": "OFF"
}
```

## Устранение неполадок

### Устройство не появляется в Zigbee2MQTT
1. Проверьте, что конвертер скопирован в правильную папку
2. Убедитесь, что Zigbee2MQTT перезапущен
3. Проверьте логи Zigbee2MQTT на ошибки

### Ошибка "Unknown device"
1. Убедитесь, что файл `RoboSR2CH10A.js` находится в папке конвертеров
2. Проверьте синтаксис файла конвертера
3. Перезапустите Zigbee2MQTT

### Поле "action" не генерируется
1. Проверьте версию конвертера
2. Убедитесь, что используется правильная версия файла
3. Проверьте логи Zigbee2MQTT

### Реле не переключаются
1. Проверьте подключение к Zigbee сети
2. Убедитесь, что устройство подключено к правильной сети
3. Проверьте логи устройства

## Обновление конвертера

### При обновлении прошивки
1. Скачайте новую версию `RoboSR2CH10A.js` из релиза
2. Замените старый файл новым
3. Перезапустите Zigbee2MQTT

### Проверка версии
В логах Zigbee2MQTT должно быть:
```
Using converter 'RoboSR2CH10A' for device 'RoboSR2CH10A'
```

## Дополнительная информация

### Поддерживаемые функции
- ✅ Управление двумя независимыми реле (state_1, state_2)
- ✅ Локальное управление кнопкой
- ✅ Синхронизация состояний
- ✅ Генерация поля "action" (on_l1, off_l1, on_l2, off_l2)
- ✅ Отображение качества связи (linkquality)

### Известные ограничения
- Поле "action" генерируется для обоих endpoint'ов одновременно
- Identify функционал не реализован

### Поддержка
При возникновении проблем:
1. Проверьте логи Zigbee2MQTT
2. Убедитесь, что используется правильная версия конвертера
3. Создайте issue в репозитории проекта
